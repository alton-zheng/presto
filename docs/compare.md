# Impala 和 Presto 比对

- 数据压缩方面（存储）
  - Impala 和 Presto 均可采用 hive 元数据，存储压力几乎相同
  - 实际情况： 
    - Impala 和 hive 不在同一个集群
      - 将 hive 源数据数据放入到 impala `HDFS`
      - 新建 hive 表， 将上一步数据 load 到 hive 表
      - 新建 impala 表， 将上一步数据写入到表中
      - 注：导入流程过长，而且数据存储了多份，浪费存储，这个流程完全可以优化
    - 表正常查询前，还需要同步维度信息，标签饱和度信息
      - 注： 流程完全可以优化



- 查询性能（前置条件： 数据和集群在同一个集群的情况下，且 impala 没开启数据缓存功能（HDFS））

  - limit

    - Presto 内置分页功能
    - 此场景下， Presto 查询快

  - 单表

    - 简单场景下
      - 聚合函数
        - 单个
          - Presto 有优势
        - 多个
          - Impala 有优势
          - 大概是 Presto 4倍
      - 单点查询
        - 例如，查询 id
        - impala 比 Presto 快 4倍 

  - 多表

    - impala 和 Presto 性能差不多
    - impala 稍微好点，可忽略

    

- 内存消耗

  - 相同数据量的情况下，Presto 比 impala 消耗内存小

    



## 现状分析

- Impala 集群 与 源数据不在同一个集群
- Presto 集群 与 源数据也不在同一集群
  - Presto 没有自己的存储架构
  - 数据没法缓存（也因为不是自己的存储架构，涉及到数据同步问题，官方没有提供相应的缓存机制）



## 优劣势

- Presto

  - 优势

    - 相比 impala 它是完全基于内存计算
    - 可以多数据源（几乎没有限制，只要能开发出对应 `Connector` ）
      - 多数据源的数据可以一起计算
      - 可以解决数据重复存储问题（跨集群）

  - 瓶颈

    - 因为需要跨集群（现状）， 网络称为了致命伤
    - 采用千兆
    - 跨 DC，跨 Rack
    - 对 hive 数据源完全兼容

    

    

## 建议

- 如果后期需要使用多个数据源来分析数据，可考虑 Presto
  - 但需要解决跨 DC，跨 Rack 数据传输问题



- 针对目前情况， 不建议使用 Presto
  - 跨集群，是致命伤，不可能达到可靠的性能要求
  - Presto 集群对 hive 数据要有完全的控制权（至少是完全读权限，包括元数据），才能进行相应的查询，如果要进行其它操作，还得开放对应的权限，比如 create, insert 等



- 可将现有引擎，针对性的进行优化
  - 存储
  - 元数据同步
  - 导数流程
  - 基本信息同步



